# 解决 403 Forbidden 完整方案

## 🔍 问题分析

403 Forbidden 可能的原因：

1. **标准 ACR 实例不存在**（只有个人版）
2. **命名空间不存在**
3. **认证方式不正确**
4. **账号密码错误**

## ✅ 解决方案

### 方案 1: 检查并创建标准 ACR 实例（推荐）

#### 步骤 1: 检查 ACR 实例类型

1. 登录：https://cr.console.aliyun.com
2. 查看顶部，确认是**标准实例**还是**个人版**
3. 如果只有个人版，需要创建标准实例

#### 步骤 2: 创建标准实例（如果需要）

1. 在 ACR 控制台，点击 **实例列表**
2. 点击 **创建实例**
3. 选择 **标准版**（按量付费）
4. 选择地域：**华东1（杭州）**
5. 创建实例

#### 步骤 3: 创建命名空间和仓库

1. 在标准实例中，创建命名空间：`algorithm-games`
2. 创建镜像仓库：`algorithm-games`

#### 步骤 4: 获取正确的认证信息

1. 在标准实例中，点击 **访问凭证**
2. 获取登录凭证：
   - 用户名：你的阿里云账号邮箱
   - 密码：ACR 服务密码（重置或查看）

#### 步骤 5: 更新 GitHub Secrets

使用标准实例的账号密码更新 Secrets。

---

### 方案 2: 使用阿里云 CLI 获取临时令牌

如果账号密码不工作，可以使用临时令牌。

#### 安装和配置阿里云 CLI

```powershell
# 安装
npm install -g @alicloud/cli

# 配置
aliyun configure set --profile default --mode AK --region cn-hangzhou --access-key-id LTAI5tFDDZiMKb29RrdPSU3h --access-key-secret Q0TbTjlio3msQKMDqcTPTQNTOE2oac

# 获取临时令牌
aliyun cr GetAuthorizationToken --Region cn-hangzhou
```

然后将临时令牌作为密码使用。

---

### 方案 3: 使用个人版 ACR + 本地构建（最简单）

如果标准 ACR 不可用或太复杂，使用个人版 + 本地 Docker：

#### 步骤 1: 安装 Docker Desktop

如果还没有安装：
- 下载：https://www.docker.com/products/docker-desktop
- 或：`winget install Docker.DockerDesktop`

#### 步骤 2: 本地构建并推送

```powershell
# 登录个人版 ACR
docker login --username=你的账号邮箱 crpi-yvms4cndr4xq7550.cn-hangzhou.personal.cr.aliyuncs.com
# 输入 ACR 服务密码

# 构建镜像
docker build -t algorithm-games .

# 打标签
docker tag algorithm-games crpi-yvms4cndr4xq7550.cn-hangzhou.personal.cr.aliyuncs.com/algorithm-games/algorithm-games:latest

# 推送镜像
docker push crpi-yvms4cndr4xq7550.cn-hangzhou.personal.cr.aliyuncs.com/algorithm-games/algorithm-games:latest
```

#### 步骤 3: 更新部署配置

更新 `ack-deployment.yaml` 中的镜像地址为个人版地址。

---

### 方案 4: 使用 ACR 控制台直接构建（无需 GitHub Actions）

如果 GitHub Actions 一直有问题，可以在 ACR 控制台直接构建：

1. 登录：https://cr.console.aliyun.com
2. 进入个人版仓库：`algorithm-games`
3. 查看是否有 **构建** 选项
4. 如果有，配置构建规则并触发构建

---

## 🎯 推荐方案

**如果标准 ACR 可用**：使用方案 1（创建标准实例）

**如果只有个人版**：使用方案 3（本地 Docker 构建）

**如果想完全自动化**：使用方案 4（ACR 控制台构建）

---

## 📋 快速检查

- [ ] 标准 ACR 实例是否存在？
- [ ] 标准 ACR 中是否有命名空间 `algorithm-games`？
- [ ] ACR 服务密码是否正确？
- [ ] GitHub Secrets 是否使用账号邮箱和 ACR 密码？

---

**建议：先检查标准 ACR 实例是否存在，如果不存在，使用方案 3（本地构建）最简单！**


