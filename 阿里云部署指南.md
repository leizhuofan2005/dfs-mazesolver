# 阿里云部署指南

## 📋 部署方案选择

阿里云提供多种部署方式，推荐以下方案：

### 方案一：容器服务 ACK（推荐，最简单）

- ✅ 支持 Docker 镜像部署
- ✅ 自动扩缩容
- ✅ 自动负载均衡
- ✅ 适合生产环境

### 方案二：容器镜像服务 ACR + 函数计算 FC

- ✅ Serverless，按量付费
- ✅ 自动扩缩容
- ✅ 适合中小型应用

### 方案三：ECS 云服务器（传统方式）

- ✅ 完全控制
- ⚠️ 需要手动配置和维护

---

## 🚀 方案一：容器服务 ACK 部署（推荐）

### 前置准备

1. **开通服务**
   - 容器服务 Kubernetes 版（ACK）
   - 容器镜像服务（ACR）

2. **获取访问凭证**
   - AccessKey ID
   - AccessKey Secret
   - 地域（Region）

### 部署步骤

#### 1. 构建并推送 Docker 镜像到 ACR

```bash
# 登录 ACR
docker login --username=你的用户名 registry.cn-hangzhou.aliyuncs.com

# 构建镜像
docker build -t algorithm-games .

# 打标签
docker tag algorithm-games registry.cn-hangzhou.aliyuncs.com/你的命名空间/algorithm-games:latest

# 推送镜像
docker push registry.cn-hangzhou.aliyuncs.com/你的命名空间/algorithm-games:latest
```

#### 2. 在 ACK 中创建应用

1. 登录阿里云控制台
2. 进入 **容器服务 Kubernetes 版**
3. 创建集群（如果还没有）
4. 创建应用，选择刚才推送的镜像
5. 配置服务：
   - 端口：8000
   - 环境变量：`ALLOWED_ORIGINS=*`（生产环境改为具体域名）

#### 3. 配置域名和负载均衡

1. 在 ACK 中创建 Ingress
2. 配置域名解析
3. 申请 SSL 证书（可选，推荐）

---

## ⚡ 方案二：函数计算 FC 部署（Serverless）

### 前置准备

1. **开通服务**
   - 函数计算 FC
   - 容器镜像服务 ACR

### 部署步骤

#### 1. 构建并推送镜像（同上）

#### 2. 创建函数

1. 登录阿里云控制台
2. 进入 **函数计算 FC**
3. 创建服务和应用
4. 选择 **容器镜像** 作为运行时
5. 选择刚才推送的镜像
6. 配置：
   - 内存：512MB
   - 超时时间：60秒
   - 环境变量：`ALLOWED_ORIGINS=*`

#### 3. 配置 HTTP 触发器

1. 创建 HTTP 触发器
2. 配置域名（可选）
3. 获取访问地址

---

## 🖥️ 方案三：ECS 云服务器部署

### 前置准备

1. **购买 ECS 实例**
   - 推荐配置：2核4GB，Ubuntu 20.04
   - 开放端口：80, 443, 8000

### 部署步骤

#### 1. 连接服务器

```bash
ssh root@你的服务器IP
```

#### 2. 安装 Docker

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

#### 3. 拉取并运行容器

```bash
# 从 GitHub 拉取代码（或使用你自己的镜像仓库）
git clone https://github.com/leizhuofan2005/dfs-mazesolver.git
cd dfs-mazesolver

# 构建镜像
docker build -t algorithm-games .

# 运行容器
docker run -d \
  -p 8000:8000 \
  -e ALLOWED_ORIGINS="*" \
  --name algorithm-games \
  algorithm-games
```

#### 4. 配置 Nginx 反向代理（可选）

```nginx
server {
    listen 80;
    server_name 你的域名;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 🔧 环境变量配置

### 后端环境变量

- `ALLOWED_ORIGINS`: CORS 允许的源（生产环境改为前端域名）
- `PORT`: 服务端口（默认 8000）

### 前端环境变量（如果前后端分离部署）

- `VITE_API_URL`: 后端 API 地址

---

## 📝 快速部署脚本

我已经创建了自动化部署脚本，见 `aliyun_deploy.sh` 和 `aliyun_deploy.ps1`

---

## 💰 费用说明

- **ACK**: 按集群和资源使用量计费
- **FC**: 按调用次数和资源使用量计费（有免费额度）
- **ECS**: 按实例规格和时长计费

---

## 🆘 需要帮助？

如果遇到问题，可以：
1. 查看阿里云官方文档
2. 联系阿里云技术支持
3. 查看项目日志排查问题

